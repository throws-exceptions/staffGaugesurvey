"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.UtilTools=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_formats=_interopRequireDefault(require("../../v-x-e-table/src/formats"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var zindexIndex=0,lastZindex=1;function getColFuncWidth(e){return e?1<arguments.length&&void 0!==arguments[1]?arguments[1]:16:0}var ColumnConfig=function(){function p(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},l=r.renderHeader,n=r.renderCell,o=r.renderFooter,i=r.renderData;_classCallCheck(this,p);var a=e.$xegrid,s=a?a.proxyOpts:null,u=t.formatter,d=!_xeUtils.default.isBoolean(t.visible)||t.visible;if(t.cellRender&&t.editRender&&UtilTools.warn("vxe.error.errConflicts",["column.cell-render","column.edit-render"]),t.editRender&&t.editRender.type,t.prop&&UtilTools.warn("vxe.error.delProp",["column.prop","column.field"]),t.label&&UtilTools.warn("vxe.error.delProp",["column.label","column.title"]),"index"===t.type?UtilTools.warn("vxe.error.delProp",["column.type=index","column.type=seq"]):"selection"===t.type?UtilTools.warn("vxe.error.delProp",["column.type=selection","column.type=checkbox"]):"expand"===t.type&&(e.treeConfig&&e.treeOpts.line&&UtilTools.error("vxe.error.errConflicts",["tree-config.line","column.type=expand"]),t.slots&&!t.slots.content&&t.slots.default&&UtilTools.warn("vxe.error.expandContent")),u)if(_xeUtils.default.isString(u)){var f=_formats.default.get(u);!f&&_xeUtils.default[u]&&(f=_xeUtils.default[u],UtilTools.warn("vxe.error.errFormat",[u])),_xeUtils.default.isFunction(f)||UtilTools.error("vxe.error.notFunc",[u])}else if(_xeUtils.default.isArray(u)){var c=_formats.default.get(u[0]);!c&&_xeUtils.default[u[0]]&&(c=_xeUtils.default[u[0]],UtilTools.warn("vxe.error.errFormat",[u[0]])),_xeUtils.default.isFunction(c)||UtilTools.error("vxe.error.notFunc",[u[0]])}Object.assign(this,{type:t.type,prop:t.prop,property:t.field||t.prop,title:t.title,label:t.label,width:t.width,minWidth:t.minWidth,resizable:t.resizable,fixed:t.fixed,align:t.align,headerAlign:t.headerAlign,footerAlign:t.footerAlign,showOverflow:t.showOverflow,showHeaderOverflow:t.showHeaderOverflow,showFooterOverflow:t.showFooterOverflow,className:t.class||t.className,headerClassName:t.headerClassName,footerClassName:t.footerClassName,indexMethod:t.indexMethod,seqMethod:t.seqMethod,formatter:u,sortable:t.sortable,sortBy:t.sortBy,sortMethod:t.sortMethod,remoteSort:t.remoteSort,filters:UtilTools.getFilters(t.filters),filterMultiple:!_xeUtils.default.isBoolean(t.filterMultiple)||t.filterMultiple,filterMethod:t.filterMethod,filterRender:t.filterRender,treeNode:t.treeNode,cellRender:t.cellRender,editRender:t.editRender,contentRender:t.contentRender,params:t.params,id:_xeUtils.default.uniqueId("col_"),parentId:null,visible:d,halfVisible:!1,defaultVisible:d,checked:!1,halfChecked:!1,disabled:!1,level:1,rowSpan:1,colSpan:1,order:null,renderWidth:0,renderHeight:0,resizeWidth:0,renderLeft:0,renderArgs:[],model:{},renderHeader:l||t.renderHeader,renderCell:n||t.renderCell,renderFooter:o||t.renderFooter,renderData:i,slots:t.slots,own:t}),s&&s.beforeColumn&&s.beforeColumn({$grid:a,column:this})}return _createClass(p,[{key:"getTitle",value:function(){return UtilTools.getFuncText(this.own.title||this.own.label||("seq"===this.type||"index"===this.type?_conf.default.i18n("vxe.table.seqTitle"):""))}},{key:"getKey",value:function(){return this.property||(this.type?"type=".concat(this.type):null)}},{key:"getMinWidth",value:function(){var e=this.type,t=this.filters,r=this.sortable,l=this.remoteSort,n=this.editRender;return 40+getColFuncWidth("checkbox"===e||"selection"===e,18)+getColFuncWidth(t)+getColFuncWidth(r||l)+getColFuncWidth(n,32)}},{key:"update",value:function(e,t){"filters"!==e&&(this[e]=t)}}]),p}();function outLog(l){return function(e,t){var r=UtilTools.getLog(e,t);return console[l](r),r}}var UtilTools={warn:outLog("warn"),error:outLog("error"),getLog:function(e,t){return"[vxe-table] ".concat(_xeUtils.default.template(_conf.default.i18n(e),t))},getFuncText:function(e){return _xeUtils.default.isFunction(e)?e():_conf.default.translate?_conf.default.translate(e):e},nextZIndex:function(){return lastZindex=_conf.default.zIndex+zindexIndex++},getLastZIndex:function(){return lastZindex},getRowkey:function(e){return e.rowId||"_XID"},getRowid:function(e,t){var r=_xeUtils.default.get(t,UtilTools.getRowkey(e));return r?encodeURIComponent(r):""},emitEvent:function(e,t,r){e.$listeners[t]&&e.$emit.apply(e,_toConsumableArray([t].concat(r)))},getColumnList:function(e){var t=[];return e.forEach(function(e){t.push.apply(t,_toConsumableArray(e.children&&e.children.length?UtilTools.getColumnList(e.children):[e]))}),t},getClass:function(e,t){return e?_xeUtils.default.isFunction(e)?e(t):e:""},getFilters:function(e){return e&&_xeUtils.default.isArray(e)?e.map(function(e){return{label:e.label,value:e.value,data:e.data,resetValue:e.resetValue,checked:!!e.checked}}):e},formatText:function(e,t){return""+(""===e||null==e?t?_conf.default.emptyCell:"":e)},getCellValue:function(e,t){return _xeUtils.default.get(e,t.property)},getCellLabel:function(e,t,r){var l=t.formatter,n=UtilTools.getCellValue(e,t),o=n;if(r&&l){var i,a,s=r.$table,u=t.id,d=s.fullAllDataRowMap;if(d.has(e)&&(a=(a=(i=d.get(e)).formatData)||(d.get(e).formatData={}),i&&a[u]&&a[u].value===n))return a[u].label;o=_xeUtils.default.isString(l)?_xeUtils.default[l]?_xeUtils.default[l](n):_formats.default.get(l)?_formats.default.get(l)({cellValue:n,row:e,column:t}):"":_xeUtils.default.isArray(l)?_xeUtils.default[l[0]]?_xeUtils.default[l[0]].apply(_xeUtils.default,[n].concat(_toConsumableArray(l.slice(1)))):_formats.default.get(l[0])?_formats.default.get(l[0]).apply(void 0,[{cellValue:n,row:e,column:t}].concat(_toConsumableArray(l.slice(1)))):"":l(Object.assign({cellValue:n},r)),a&&(a[u]={value:n,label:o})}return o},setCellValue:function(e,t,r){return _xeUtils.default.set(e,t.property,r)},getColumnConfig:function(e,t,r){return t instanceof ColumnConfig?t:new ColumnConfig(e,t,r)},assemColumn:function(e){var t=e.$el,r=e.$xetable,l=e.$xecolumn,n=e.columnConfig,o=l?l.columnConfig:null;n.slots=e.$scopedSlots,o&&0<l.$children.length?(o.children||(o.children=[]),o.children.splice([].indexOf.call(l.$el.children,t),0,n)):r.collectColumn.splice([].indexOf.call(r.$refs.hideColumn.children,t),0,n)},destroyColumn:function(e){var t=e.$xetable,r=e.columnConfig,l=_xeUtils.default.findTree(t.collectColumn,function(e){return e===r});l&&l.items.splice(l.index,1)},hasChildrenList:function(e){return e&&e.children&&0<e.children.length},parseFile:function(e){var t=e.name,r=_xeUtils.default.lastIndexOf(t,"."),l=t.substring(r+1,t.length);return{filename:t.substring(0,r),type:l}}},_default=exports.UtilTools=UtilTools;exports.default=_default;